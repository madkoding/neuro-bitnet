# =============================================================================
# neuro-bitnet - Variables de Entorno
# Copia este archivo a .env y ajusta según tu configuración
# =============================================================================

# -----------------------------------------------------------------------------
# SELECCIÓN DE MODELO (Docker Hub: madkoding/neuro-bitnet)
# -----------------------------------------------------------------------------
#
# Modelos disponibles:
#
# falcon-10b (default) - Falcon3-10B-Instruct-1.58bit
#   - Tamaño imagen: ~6.5 GB
#   - VRAM/RAM: ~3 GB  
#   - Calidad: ⭐⭐⭐⭐⭐ (máxima)
#   - Velocidad: Moderada
#   - Ideal para: Producción, máxima calidad de respuestas
#
# bitnet-2b - Microsoft BitNet-b1.58-2B-4T  
#   - Tamaño imagen: ~4 GB
#   - VRAM/RAM: ~800 MB
#   - Calidad: ⭐⭐⭐
#   - Velocidad: ⚡⚡⚡ (muy rápido)
#   - Ideal para: Desarrollo, edge computing, recursos limitados
#
BITNET_MODEL=falcon-10b

# -----------------------------------------------------------------------------
# GPU Configuration
# -----------------------------------------------------------------------------

# GPU a utilizar (0, 1, 2... o "all")
CUDA_VISIBLE_DEVICES=0

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Puerto externo (interno siempre es 8080)
# Usa 11435 para coexistir con Ollama (11434)
BITNET_EXTERNAL_PORT=11435

# Tamaño de contexto en tokens (máximo 4096 para BitNet-2B)
# Distribución sugerida:
#   - System prompt: ~500 tokens
#   - Tool definitions (MCP): ~800 tokens  
#   - RAG chunks: ~1200 tokens
#   - Historial/memoria: ~1000 tokens
#   - Query + respuesta: ~500 tokens
BITNET_CTX_SIZE=4096

# Slots paralelos (requests concurrentes)
# Cada slot consume ~300MB VRAM adicional con ctx=4096
# Recomendado: 2-4 para la mayoría de casos
BITNET_PARALLEL=4

# Capas en GPU (99 = todas)
# Poner 0 para modo CPU puro
BITNET_GPU_LAYERS=99

# Threads CPU (para operaciones no-GPU)
BITNET_THREADS=4

# -----------------------------------------------------------------------------
# Sampling Parameters (Quality Tuning)
# -----------------------------------------------------------------------------

# Temperature: 0.0-2.0 (menor = más determinista, mayor = más creativo)
# Recomendado: 0.3-0.5 para código, 0.7-1.0 para texto creativo
BITNET_TEMPERATURE=0.7

# Top-K: limita a los K tokens más probables (0 = desactivado)
# Menor valor = respuestas más enfocadas
BITNET_TOP_K=40

# Top-P (nucleus): considera tokens hasta acumular probabilidad P
# 0.9-0.95 es un buen balance
BITNET_TOP_P=0.95

# Repeat Penalty: penaliza repeticiones (1.0 = sin penalización)
# 1.1-1.2 ayuda a evitar loops repetitivos
BITNET_REPEAT_PENALTY=1.1

# Min-P: filtra tokens con probabilidad < min_p * max_prob
# Ayuda a eliminar tokens muy improbables
BITNET_MIN_P=0.05

# -----------------------------------------------------------------------------
# Advanced Sampling (para usuarios avanzados)
# -----------------------------------------------------------------------------

# Presence Penalty: penaliza tokens que ya aparecieron (0.0 = desactivado)
# Ayuda a introducir nuevos temas
BITNET_PRESENCE_PENALTY=0.0

# Frequency Penalty: penaliza tokens según frecuencia (0.0 = desactivado)
# Reduce repetición de palabras comunes
BITNET_FREQUENCY_PENALTY=0.0

# Repeat Last N: cuántos tokens considerar para repeat penalty
# Mayor valor = considera más contexto
BITNET_REPEAT_LAST_N=64

# TFS (Tail Free Sampling): elimina tokens de baja probabilidad (1.0 = desactivado)
# Valores como 0.95 pueden mejorar coherencia
BITNET_TFS_Z=1.0

# Typical P: locally typical sampling (1.0 = desactivado)
# Valores como 0.95 favorecen tokens "típicos" del contexto
BITNET_TYPICAL_P=1.0

# Mirostat: algoritmo alternativo de sampling (0 = desactivado, 1 o 2 = activado)
# Mirostat 2 suele dar mejores resultados
# NOTA: Si activas Mirostat, Top-K/Top-P/TFS/Typical se ignoran
BITNET_MIROSTAT=0

# Mirostat Tau: entropía objetivo (default: 5.0)
# Menor = más coherente, Mayor = más diverso
BITNET_MIROSTAT_TAU=5.0

# Mirostat Eta: learning rate (default: 0.1)
BITNET_MIROSTAT_ETA=0.1

# -----------------------------------------------------------------------------
# Performance Tuning
# -----------------------------------------------------------------------------

# Batch size para prompt processing (mayor = más rápido pero más RAM)
BITNET_BATCH_SIZE=2048

# Micro batch size (para GPUs con poca VRAM, reducir)
BITNET_UBATCH_SIZE=512

# Threads para batch processing (default: igual que THREADS)
BITNET_THREADS_BATCH=4

# KV Cache defragmentation threshold (0.1 = 10% fragmentación)
BITNET_DEFRAG_THOLD=0.1

# Cache reuse: min tokens para reutilizar KV cache entre requests
# Mayor valor = más reutilización pero puede afectar calidad
BITNET_CACHE_REUSE=256

# -----------------------------------------------------------------------------
# HuggingFace (opcional)
# -----------------------------------------------------------------------------

# Token de HuggingFace (solo necesario para modelos gated)
# Obtener en: https://huggingface.co/settings/tokens
HF_TOKEN=

# -----------------------------------------------------------------------------
# Notas de Configuración
# -----------------------------------------------------------------------------
#
# VRAM estimada con configuración por defecto:
#   - Modelo BitNet-2B: ~800 MB
#   - KV Cache (4 slots x 4096 ctx): ~1.2 GB
#   - Total: ~2 GB VRAM
#
# Para GPUs con menos VRAM, reducir:
#   - BITNET_PARALLEL=2
#   - BITNET_CTX_SIZE=2048
#
# API Endpoints disponibles (compatible OpenAI):
#   - POST /v1/chat/completions  (chat)
#   - POST /v1/completions       (completion)
#   - GET  /v1/models            (listar modelos)
#   - GET  /health               (healthcheck)
#   - GET  /metrics              (Prometheus metrics)
#
# =============================================================================
